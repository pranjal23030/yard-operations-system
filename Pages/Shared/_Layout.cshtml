@using Microsoft.AspNetCore.Identity
@using YardOps.Data

@inject SignInManager<ApplicationUser> SignInManager

@{
    // Determine user role for layout rendering
    var isAdmin = User.IsInRole("Admin");
    var isYardManager = User.IsInRole("YardManager");
    var isDriver = User.IsInRole("Driver");
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - YardOps</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @await RenderSectionAsync("Styles", required: false)
</head>
<body>

    @* Render role-specific sidebar *@
    @if (SignInManager.IsSignedIn(User))
    {
        if (isAdmin)
        {
            <partial name="_AdminSidebar" />
        }
        else if (isYardManager)
        {
            <partial name="_YardManagerSidebar" />
        }
        else if (isDriver)
        {
            <partial name="_DriverSidebar" />
        }
    }

    <div id="main-wrapper">
        <header>
            <nav class="navbar navbar-expand-sm admin-header">
                <div class="container-fluid">
                    <span class="admin-dash-text">@ViewData["PageHeader"]</span>
                    <div class="ms-auto d-flex align-items-center gap-2">
                        <partial name="_LoginPartial" />
                    </div>
                </div>
            </nav>
        </header>

        <main role="main">
            @RenderBody()
        </main>

        <footer class="footer admin-footer">
            <div class="container-fluid">
                <div class="admin-footer-inner">
                    <div class="admin-footer-left">
                        <i class="fa-solid fa-wave-square footer-icon" aria-hidden="true"></i>
                        <span class="footer-brand">YardOps</span>
                        <span class="footer-sep">|</span>
                        <span class="footer-sub">
                            @if (isAdmin)
                            {
                                @:Administrator Portal
                            }
                            else if (isYardManager)
                            {
                                @:Yard Manager Portal
                            }
                            else if (isDriver)
                            {
                                @:Driver Portal
                            }
                            else
                            {
                                @:Yard Operations System
                            }
                        </span>
                    </div>
                    <div class="admin-footer-right">
                        <span>© @DateTime.Now.Year All rights reserved</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');
        const toggleIcon = document.getElementById('toggleIcon');

        if (toggleBtn && sidebar) {
            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');

                if (toggleIcon) {
                    if (sidebar.classList.contains('collapsed')) {
                        toggleIcon.classList.remove('fa-angles-left');
                        toggleIcon.classList.add('fa-bars');
                    } else {
                        toggleIcon.classList.remove('fa-bars');
                        toggleIcon.classList.add('fa-angles-left');
                    }
                }
            });
        }

        // Highlight active nav link based on current page
        const currentPath = window.location.pathname;
        $('.nav-item-link').each(function() {
            const href = $(this).attr('href');
            if (href && href !== '#' && currentPath.includes(href)) {
                $('.nav-item-link').removeClass('active');
                $(this).addClass('active');
            }
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>