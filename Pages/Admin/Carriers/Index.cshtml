@page
@using YardOps.Pages.Admin.Carriers
@model IndexModel
@{
    ViewData["Title"] = "Carriers";
    ViewData["PageHeader"] = "Carrier Management";
}

@section Styles {
    <link rel="stylesheet" href="~/css/components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/carriers.css" asp-append-version="true" />
}

<!-- Alerts -->
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-check-circle me-2"></i>
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Deleted"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-check-circle me-2"></i>
        @TempData["Deleted"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-circle-exclamation me-2"></i>
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Header -->
<div class="carrier-header-card">
    <div class="carrier-header-content">
        <div class="carrier-header-icon">
            <i class="fa-solid fa-building"></i>
        </div>
        <div class="carrier-header-text">
            <h1 class="carrier-title">All Carriers</h1>
            <p class="carrier-subtitle">Manage trucking companies and their information</p>
        </div>
    </div>
    <button type="button" class="btn-add-carrier" data-bs-toggle="modal" data-bs-target="#createCarrierModal">
        <i class="fa-solid fa-plus me-1"></i>
        Add Carrier
    </button>
</div>

<!-- Filters -->
<form method="get" id="filterForm">
    <input type="hidden" name="PageNumber" value="1" />
    <div class="filters-row">
        <div class="search-box">
            <i class="fa-solid fa-search search-icon"></i>
            <input type="text" name="SearchTerm" value="@Model.SearchTerm" class="form-control"
                   placeholder="Search carriers..." onchange="this.form.submit()" />
        </div>
        <div class="filter-dropdown-wrapper">
            <select name="StatusFilter" class="filter-select" onchange="this.form.submit()">
                @foreach (var status in Model.StatusOptions)
                {
                    var isSelected = Model.StatusFilter == status.Value || (string.IsNullOrEmpty(Model.StatusFilter) && status.Value == "all");
                    <option value="@status.Value" selected="@isSelected">@status.Text</option>
                }
            </select>
        </div>
    </div>
</form>

<!-- Carriers Table -->
<div class="users-table">
    <table>
        <thead>
            <tr>
                <th>Carrier ID</th>
                <th>Company Name</th>
                <th>Contact Person</th>
                <th>Phone</th>
                <th>Trailers</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Carriers.Any())
            {
                @foreach (var carrier in Model.Carriers)
                {
                    <tr>
                        <td data-label="Carrier ID">
                            <span class="carrier-code">@carrier.CarrierCode</span>
                        </td>
                        <td data-label="Company">
                            <div class="company-cell">
                                <div class="company-icon">
                                    <i class="fa-solid fa-building"></i>
                                </div>
                                <span class="company-name">@carrier.CompanyName</span>
                            </div>
                        </td>
                        <td data-label="Contact">
                            <span class="contact-person">@(carrier.ContactPerson ?? "—")</span>
                        </td>
                        <td data-label="Phone">
                            <span class="phone-number">@(carrier.Phone ?? "—")</span>
                        </td>
                        <td data-label="Trailers">
                            <span class="trailer-count-badge">@carrier.TrailerCount</span>
                        </td>
                        <td data-label="Status">
                            <span class="status-badge status-@carrier.Status.ToLower()">@carrier.Status</span>
                        </td>
                        <td data-label="Actions">
                            <div class="dropdown">
                                <button class="action-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa-solid fa-ellipsis-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end action-dropdown">
                                    <li>
                                        <a class="dropdown-item action-item" href="#"
                                           data-bs-toggle="modal" data-bs-target="#viewCarrierModal"
                                           data-carrier-id="@carrier.CarrierId"
                                           data-carrier-code="@carrier.CarrierCode"
                                           data-carrier-companyname="@carrier.CompanyName"
                                           data-carrier-contactperson="@carrier.ContactPerson"
                                           data-carrier-phone="@carrier.Phone"
                                           data-carrier-email="@carrier.Email"
                                           data-carrier-address="@carrier.Address"
                                           data-carrier-status="@carrier.Status"
                                           data-carrier-trailercount="@carrier.TrailerCount">
                                            <i class="fa-solid fa-eye me-2"></i>View
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item action-item" href="#"
                                           data-bs-toggle="modal" data-bs-target="#editCarrierModal"
                                           data-carrier-id="@carrier.CarrierId"
                                           data-carrier-code="@carrier.CarrierCode"
                                           data-carrier-companyname="@carrier.CompanyName"
                                           data-carrier-contactperson="@carrier.ContactPerson"
                                           data-carrier-phone="@carrier.Phone"
                                           data-carrier-email="@carrier.Email"
                                           data-carrier-address="@carrier.Address"
                                           data-carrier-status="@carrier.Status">
                                            <i class="fa-solid fa-pen-to-square me-2"></i>Edit
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider" /></li>
                                    <li>
                                        <a class="dropdown-item action-item-delete" href="#"
                                           data-bs-toggle="modal" data-bs-target="#deleteCarrierModal"
                                           data-carrier-id="@carrier.CarrierId"
                                           data-carrier-name="@carrier.CompanyName"
                                           data-carrier-code="@carrier.CarrierCode">
                                            <i class="fa-solid fa-trash me-2"></i>Delete
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center py-5 text-muted">
                        <i class="fa-solid fa-building fa-3x mb-3 d-block"></i>
                        No carriers found
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Pagination -->
<div class="pagination-footer">
    <div class="pagination-info">
        @{
            var startItem = Model.TotalCarriers == 0 ? 0 : ((Model.CurrentPage - 1) * 10) + 1;
            var endItem = Math.Min(Model.CurrentPage * 10, Model.TotalCarriers);
        }
        Showing @startItem to @endItem of @Model.TotalCarriers carriers
    </div>
    <div class="pagination-controls">
        @if (Model.CurrentPage > 1)
        {
            <a href="?PageNumber=@(Model.CurrentPage - 1)&SearchTerm=@Model.SearchTerm&StatusFilter=@Model.StatusFilter" class="page-btn">
                <i class="fa-solid fa-chevron-left"></i>
            </a>
        }
        else
        {
            <button class="page-btn" disabled><i class="fa-solid fa-chevron-left"></i></button>
        }

        @for (var i = 1; i <= Model.TotalPages; i++)
        {
            if (i == Model.CurrentPage)
            {
                <button class="page-btn active">@i</button>
            }
            else
            {
                <a href="?PageNumber=@i&SearchTerm=@Model.SearchTerm&StatusFilter=@Model.StatusFilter" class="page-btn">@i</a>
            }
        }

        @if (Model.CurrentPage < Model.TotalPages)
        {
            <a href="?PageNumber=@(Model.CurrentPage + 1)&SearchTerm=@Model.SearchTerm&StatusFilter=@Model.StatusFilter" class="page-btn">
                <i class="fa-solid fa-chevron-right"></i>
            </a>
        }
        else
        {
            <button class="page-btn" disabled><i class="fa-solid fa-chevron-right"></i></button>
        }
    </div>
</div>

<!-- Modals -->
<partial name="_Partials/_CreateCarrierModal" />
<partial name="_Partials/_EditCarrierModal" />
<partial name="_Partials/_ViewCarrierModal" />
<partial name="_Partials/_DeleteCarrierModal" />

@section Scripts {
    <partial name="_Partials/_CarrierScripts" />
}